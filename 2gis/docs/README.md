2GIS Demo App — документация

Обзор
- Демо на SwiftUI, интегрирующее маршрутизацию 2GIS и вспомогательные сервисы.
- Показывает полилинию маршрута, узлы манёвров и динамические окна‑«билборды» с подсказками.
- Поддерживает как реальный GPS через CoreLocation, так и воспроизведение GPX для повторяемых прогонов.

Ключевые возможности
- Построение маршрута через 2GIS Routing API.
- Отрисовка компактного оверлея (Canvas) с манёврами и полной полилинией.
- Генерация вспомогательных билбордов каждые N метров и показ ближайшего в отдельном окне.
- Отслеживание прогресса по маршруту и вывод подсказки поворота на основе сравнения курса и касательной маршрута.
- Опциональные запросы непрерывного map matching (с троттлингом) для уточнения траектории.
- Опциональное воспроизведение GPX для тестирования «на месте».

Основные модули
- AppModel: централизованное состояние (маршрут, узлы, полилиния, сгенерированные билборды, состояние пользователя).
- ContentView: основной UI, инициирует построение маршрута, рисует оверлей, управляет окнами билбордов.
- NavigationViewModel: вызывает API 2GIS (маршрутизация, map matching, радарная геолокация) и управляет непрерывным map matching.
- NavigationAPIClient: низкоуровневый HTTP‑клиент для эндпоинтов 2GIS с JSON‑кодированием/декодированием.
- LocationService: обёртка над CoreLocation и реализация GPX‑плейбэка.
- SignpostWindow: небольшое окно с текущей подсказкой и опциональной дистанцией до следующей точки.
- RouteOverlayModels: лёгкие типы данных (узел манёвра, полилиния, хелперы geo↔︎метры).

Логика билбордов (вкратце)
- После построения маршрута создаются точки каждые 10 метров вдоль полилинии.
- При изменении позиции пользователя она проецируется на маршрут, чтобы получить прогресс (в метрах).
- Приложение открывает единственное окно для ближайшей точки впереди и закрывает остальные.
- Окна закрываются с тем же value, с которым открывались, чтобы избежать «залипаний».

Подсказка поворота
- Вычисляется по углу между вектором движения пользователя и касательной маршрута в точке проекции.
- Пороги: прямо (<10°), слегка (10–45°), повернуть (45–90°), развернуться (>90°).

Мок‑GPS по GPX
- LocationService поддерживает режим воспроизведения GPX с временными метками и настраиваемой скоростью.
- Все потребители обновлений локации работают одинаково в обоих режимах.

Map Matching
- NavigationViewModel периодически отправляет последние точки на 2GIS Map Matching API.
- Ответ сохраняется и при необходимости может использоваться для уточнения позиции далее по конвейеру.

Подробности в следующих файлах:
- docs/architecture.md — компоненты и поток данных
- docs/location.md — реальный GPS и GPX‑мок, скорость воспроизведения
- docs/navigation.md — маршрутизация, манёвры, извлечение полилинии
- docs/billboards.md — генерация, динамика окон, жизненный цикл
- docs/api.md — кратко о клиенте и моделях
